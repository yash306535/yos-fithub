<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Gym Template">
    <meta name="keywords" content="Gym, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>yos-fithub | Plans</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css?family=Muli:300,400,500,600,700,800,900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Oswald:300,400,500,600,700&display=swap" rel="stylesheet">

    <!-- Css Styles -->
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="css/flaticon.css" type="text/css">
    <link rel="stylesheet" href="css/owl.carousel.min.css" type="text/css">
    <link rel="stylesheet" href="css/barfiller.css" type="text/css">
    <link rel="stylesheet" href="css/magnific-popup.css" type="text/css">
    <link rel="stylesheet" href="css/slicknav.min.css" type="text/css">
    <link rel="stylesheet" href="css/style.css" type="text/css">
    <link rel="stylesheet" href="css/plan.css" type="text/css">
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

</head>

<body onload="display()">

    <!-- Page Preloder -->
    <div id="preloder">
        <div class="loader"></div>
    </div>

    <!-- Offcanvas Menu Section Begin -->
    <div class="offcanvas-menu-overlay"></div>
    <div class="offcanvas-menu-wrapper">
        <div class="canvas-close">
            <i class="fa fa-close"></i>
        </div>
        <div class="canvas-search search-switch">
            <i class="fa fa-search"></i>
        </div>
        <nav class="canvas-menu mobile-menu">
            <ul>
                <li><a href="./index2">Home</a></li>
                <li><a href="./about-us.html">About Us</a></li>
                <li><a href="./classes.html">Classes</a></li>
                <li><a href="./services.html">Services</a></li>
                <li><a href="./team.html">Our Team</a></li>
                <li><a href="#">Pages</a>
                    <ul class="dropdown">
                        <li><a href="./about-us.html">About us</a></li>
                        <li><a href="./class-timetable.html">Classes timetable</a></li>
                        <li><a href="./bmi-calculator.html">Bmi calculate</a></li>
                        <li><a href="./team.html">Our team</a></li>
                        <li><a href="./gallery.html">Gallery</a></li>
                        <li><a href="./blog.html">Our blog</a></li>
                    </ul>
                </li>
                <li><a href="./contact.html">Contact</a></li>
            </ul>
        </nav>
        <div id="mobile-menu-wrap"></div>
        <div class="canvas-social">
            <a href="#"><i class="fa fa-facebook"></i></a>
            <a href="#"><i class="fa fa-twitter"></i></a>
            <a href="#"><i class="fa fa-youtube-play"></i></a>
            <a href="#"><i class="fa fa-instagram"></i></a>
        </div>
    </div>
    <!-- Offcanvas Menu Section End -->

     <!-- Header Section Begin -->
    <header class="header-section">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-3">
                <div class="logo">
                    <a href="/index2">
                        <img src="img/logo.png" alt="" style="	width: 100px;
	                                                            height: 100px;
                                                                margin-top: -35px;
                                                                margin-left: 250px;
                                                                ">
                    </a>
                </div>
            </div>
            <div class="col-lg-6">
                <nav class="nav-menu">
                <ul>
                        <li><a href="/userDashboard">Home</a></li>

                        <li><a href="#">Account</a>
                            <ul class="dropdown">
                                <!-- <li><a href="/user-profile">set User Profile</a></li> -->
                                <li><a href="/show-user-profile">Show User Profile</a></li>
                                <li><a href="/index2">Logout</a></li>
                                
                                <li id="log"><a href="/alogin" >Admin Login</a></li>
                                
                            </ul>
                        </li>

                        <li><a href="/trainer1">Trainers</a></li>
                        <li><a href="/team">Our Team</a></li>                           
                        <li><a href="./plans">Plans</a></li>
                        <li><a href="#">Services</a>
                            <ul class="dropdown">
                                <li><a href="./buyed-plans-user"> buyed Plans</a></li>
                                <li><a href="/calculator1">Health Calculators</a></li>
                                <li><a href="/feedback1">Feedback</a></li>
                                <li><a href="/about-us">About us</a></li>

                            </ul>
                        </li>
                        <li><a href="/contact">Contact</a></li>

                        <li><a href="/about-us">About Us</a></li>
                    </ul>
            </div>
        </nav>
            <div class="col-lg-3">
                <div class="top-option">
                    <div class="to-search search-switch">
                        <i class="fa fa-search"></i>
                    </div>
                    <div class="to-social">
                        <a href="#"><i class="fa fa-facebook"></i></a>
                        <a href="#"><i class="fa fa-twitter"></i></a>
                        <a href="#"><i class="fa fa-youtube-play"></i></a>
                        <a href="#"><i class="fa fa-instagram"></i></a>
                    </div>
                    <!-- Add Login/Register Links -->
              
                </div>
            </div>
        </div>
        <div class="canvas-open">
            <i class="fa fa-bars"></i>
        </div>
    </div>
</header>
<section class="hero-section">
    <div class="hs-slider owl-carousel">
        <div class="hs-item set-bg" data-setbg="img/hero/hero-1.jpg" style="height: fit-content;">
            
        </div>
       
    </div>
</section>
  
    <div class="container">

       
        <div class="plans-list-container">
            <h2>Our Plans</h2>
            <div class="sort-select">
            <label for="sortSelect">Sort by:</label>
            <select id="sortSelect" onchange="sortPlansByAge()">
                <option value="ageGroup1">Age Group: 18-25</option>
                <option value="ageGroup2">Age Group: 26-35</option>
                <option value="ageGroup3">Age Group: 36-50</option>
                <option value="ageGroup4">Age Group: 51+</option>
            </select>
        </div>
            <div class="plans-list" id="plansList">
                <% plans.forEach(plan => { %>
                    <div class="plan-card">
                        <p class="name-label">Name: <%= plan.name %></p>
            
                        <p><b>Price :</b> $<%= plan.price %></p>
                        <p><b>Duration :</b> <%= plan.duration %> days</p>
                        <p><b>Diet :</b> <%= plan.diet %></p>
                        <p><b>Exercise :</b> <%= plan.exercise %></p>
                        <p><b>Special Designed For :</b> <%= plan.specialDesignedFor %></p>
                        <p><b>Age Group :</b> <%= plan.ageGroup %></p>
                        <p><b>Category :</b> <%= plan.category %></p>
                        <p><b>Intensity :</b> <%= plan.intensity %></p>
                        <p><b>Required Equipment :</b> <%= plan.requiredEquipment %></p>
                        <p><b>Target :</b> <%= plan.target %></p>
                        <p><b>Difficulty :</b> <%= plan.difficulty %></p>
                        <p><b>Frequency :</b> <%= plan.frequency %></p>
                        <p><b>Benefits :</b> <%= plan.benefits %></p>
                        
            
                        <p><b>Trainer Name :</b> <%= plan.trainer %></p>
                        <p><b>Trainer  Email :</b> <%= plan.trainerEmail %></p>
                       <!-- Inside your plan-card div -->
                      <!-- Add this inside the plan-card div -->
                      <a href="#" class="buy-plan-btn" data-plan-id="<%= plan._id %>" data-trainer-email="<%= plan.trainerEmail %>">Buy Plan</a>

                    </div>
                <% }); %>
            </div>
            
    </div>
    </div>
        <!-- Footer Section Begin -->
    <%- include('footer') %>

    <div class="search-model">
        <div class="h-100 d-flex align-items-center justify-content-center">
            <div class="search-close-switch">+</div>
            <form class="search-model-form">
                <input type="text" id="search-input" placeholder="Search here.....">
            </form>
        </div>
    </div>
    <!-- Search model end -->

    <!-- Js Plugins -->
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/masonry.pkgd.min.js"></script>
    <script src="js/jquery.barfiller.js"></script>
    <script src="js/jquery.slicknav.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/main.js"></script> 
    <script>
        function sortPlansByAge() {
            var selectElement = document.getElementById("sortSelect");
            var selectedOption = selectElement.options[selectElement.selectedIndex].value;
    
            var plansList = document.getElementById("plansList");
            var planCards = plansList.getElementsByClassName("plan-card");
    
            var sortedPlanCards = Array.from(planCards).sort(function (a, b) {
                var ageGroupA = a.getAttribute("data-age-group");
                var ageGroupB = b.getAttribute("data-age-group");
    
                if (selectedOption === "ageGroup1") {
                    return ageGroupA.localeCompare(ageGroupB);
                } else if (selectedOption === "ageGroup2") {
                    // Implement sorting logic for ageGroup2
                } else if (selectedOption === "ageGroup3") {
                    // Implement sorting logic for ageGroup3
                } else if (selectedOption === "ageGroup4") {
                    // Implement sorting logic for ageGroup4
                }
            });
    
            // Clear and append sorted cards to plansList
            plansList.innerHTML = "";
            sortedPlanCards.forEach(function (card) {
                plansList.appendChild(card);
            });
        }
    </script> 
<script>
    document.querySelectorAll('.buy-plan-btn').forEach(button => {
        button.addEventListener('click', async (event) => {
            event.preventDefault();

            const planId = button.dataset.planId;
            const trainerEmail = button.dataset.trainerEmail;

            // Check if the user has already purchased the plan
            const alreadyPurchased = await checkPlanPurchase(planId);
            if (alreadyPurchased) {
                alert('You have already purchased this plan.');
                return;
            }

            // Fetch details of the selected plan (name, price, etc.) from the server if needed

            // Create Razorpay order
            const response = await fetch('/create-razorpay-order', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ planId, trainerEmail }),
            });

            const orderData = await response.json();

            // Open Razorpay payment modal
            var options = {
                key: 'YOUR_RAZORPAY_KEY_ID', // Your Razorpay API key
                amount: orderData.amount, // Amount in paise
                currency: 'INR',
                name: 'YOS FITHUB',
                description: 'Plan Purchase',
                order_id: orderData.id,
                handler: function (response) {
                    // Handle successful payment
                    console.log('Payment success:', response);

                    // After successful payment, perform additional actions here
                    // For example, trigger the plan purchase API call
                    purchasePlan(planId, trainerEmail);
                },
                prefill: {
                    email: 'user@example.com', // Default email address (optional)
                },
                notes: {
                    planId: planId,
                    trainerEmail: trainerEmail,
                },
                theme: {
                    color: '#F37254' // Color for the payment button (optional)
                }
            };
            var rzp = new Razorpay(options);
            rzp.open();
        });
    });

    async function checkPlanPurchase(planId) {
        try {
            const response = await fetch(`/check-plan-purchase?planId=${planId}`);
            const data = await response.json();
            return data.alreadyPurchased;
        } catch (error) {
            console.error('Error checking plan purchase:', error);
            return false;
        }
    }

    async function purchasePlan(planId, trainerEmail) {
        try {
            const response = await fetch('/buy-plan', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ planId, trainerEmail }), // Include planId and trainerEmail in the request body
            });

            console.log('Purchase plan response:', response);

            if (response.ok) {
                alert('Plan purchased successfully');
                // Optionally, you can redirect or update UI here
            } else {
                alert('Failed to purchase plan');
            }
        } catch (error) {
            alert('Error processing plan purchase:', error);
        }
    }
</script>


    

    



    
    

   </body>
   

</html>